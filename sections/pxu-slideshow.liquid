{%- comment -%}
  ðŸ§° Slideshow section
{%- endcomment -%}

<section
  id="{{ section.id }}"
  class="
    pxu-section
    pxu-section--animated-{{ section.settings.enable_animations }}
    pxu-slideshow
  "
  style="
    --pxu-section-content-width: {{ section.settings.content_width }};
    --pxu-section-placeholder-fill-color: {{ '#000000' | color_modify: 'alpha', 0.35 }};
    --pxu-section-placeholder-background-color: {{ '#000000' | color_modify: 'alpha', 0.15 }};
    --pxu-section-margin-top: {{ section.settings.margin_top }}px;
    --pxu-section-margin-bottom: {{ section.settings.margin_bottom }}px;
    --pxu-carousel-prev-next-position: var(--pxu-space-6);
  "
  data-pxu-slideshow
>
  <script
    type="application/json"
    data-component-data
  >
    {
      "id": "{{ section.id }}",
      "handle": "pxu-slideshow",
      "className": "SlideshowSection",
      "name": "Slideshow",
      "version": "1.0.2",
      "scriptsUrl": "{{ 'scripts.js' | asset_url | replace: '/assets/', '/compiled_assets/' }}",
      "autoplay": {{ section.settings.autoplay }},
      "autoplayDuration": {{ section.settings.autoplay_duration }}
    }
  </script>

  <div
    class="
      pxu-section__container
      pxu-section__container--full-width
      pxu-slideshow__container
    "
  >
    {%- if section.blocks.size > 0 -%}
      <div
        class="
          pxu-carousel
          pxu-carousel--fade
          pxu-carousel--dots-above
          pxu-carousel--slideshow-arrows
          pxu-carousel--fit-content-height
          pxu-carousel--dynamic-colors
        "
      >
        <div class="pxu-carousel__items" data-pxu-carousel>
          {%- for block in section.blocks -%}
            <div
              id="{{ block.id }}"
              class="pxu-carousel__item"
              tabindex="-1"
              data-pxu-carousel-item
              data-pxu-carousel-item-color="{{ block.settings.text_color }}"
            >
              {%- liquid
                assign first_block = section.blocks[0]
                assign heading = block.settings.heading
                assign text = block.settings.text
                assign image = block.settings.image
                assign image_overlay_color = block.settings.image_overlay_color
                assign image_overlay_color_alpha = image_overlay_color | color_extract: 'alpha'
                assign image_overlay_opacity = block.settings.image_overlay_opacity | divided_by: 100.0
                assign mobile_image = block.settings.mobile_image
                assign placeholder_number = forloop.index0 | modulo: 2 | plus: 1
                assign placeholder = 'lifestyle-' | append: placeholder_number

                assign button_1_label = block.settings.button_1_label
                assign button_1_url = block.settings.button_1_url
                assign button_1_style = block.settings.button_1_style
                assign button_1_background_color = block.settings.button_1_background_color
                assign button_1_text_color = block.settings.button_1_text_color
                assign button_1_brightness = button_1_background_color | color_brightness
                assign button_1_brightness_mod = 'light-on-dark'
                if button_1_brightness > 127.5
                  assign button_1_brightness_mod = 'dark-on-light'
                endif

                assign button_2_label = block.settings.button_2_label
                assign button_2_url = block.settings.button_2_url
                assign button_2_style = block.settings.button_2_style
                assign button_2_background_color = block.settings.button_2_background_color
                assign button_2_text_color = block.settings.button_2_text_color
                assign button_2_brightness = button_2_background_color | color_brightness
                assign button_2_brightness_mod = 'light-on-dark'
                if button_2_brightness > 127.5
                  assign button_2_brightness_mod = 'dark-on-light'
                endif
              -%}

              <div class="pxu-slideshow__slide" {{ block.shopify_attributes }}>
                <div
                  class="
                    pxu-slideshow__image-wrapper
                    pxu-slideshow__image-wrapper--{{ section.settings.slide_height }}
                  "
                  style="
                    --pxu-section-desktop-aspect-ratio: {{ first_block.settings.image.aspect_ratio | default: first_block.settings.mobile_image.aspect_ratio  }};
                    --pxu-section-mobile-aspect-ratio: {{ first_block.settings.mobile_image.aspect_ratio | default: first_block.settings.image.aspect_ratio  }};
                    {% if image_overlay_color_alpha != 0 %}
                      --pxu-section-image-overlay-color: {{ image_overlay_color | color_modify: 'alpha', image_overlay_opacity }};
                    {% endif %}
                  "
                  data-pxu-slideshow-image-wrapper
                >
                  {%- if image or mobile_image -%}
                    <picture class="pxu-slideshow__picture">
                      <source media="(max-width: 860px)" srcset="{{ mobile_image | image_url: width: 800 }}">
                      {%- if image -%}
                        <source media="(min-width: 860px)" srcset="{{ image | image_url: width: 2000 }}">
                        {{- image | image_url: width: 1800 | image_tag: class: 'pxu-slideshow__image' -}}
                      {%- else -%}
                        <source media="(min-width: 860px)" srcset="{{ mobile_image | image_url: width: 800 }}">
                        {{- mobile_image | image_url: width: 1800 | image_tag: class: 'pxu-slideshow__image pxu-slideshow__image--mobile' -}}
                      {%- endif -%}
                    </picture>
                  {%- else -%}
                    {{- placeholder | placeholder_svg_tag: 'pxu-slideshow__placeholder pxu-placeholder' -}}
                  {%- endif -%}

                  {%- if heading != blank or text != blank or button_1_label != blank or button_2_label != blank -%}
                    <div
                      class="
                        pxu-slideshow__content-wrapper
                        pxu-slideshow__content-wrapper--align-{{ block.settings.content_alignment }}
                        pxu-slideshow__content-wrapper--mobile-align-{{ block.settings.content_alignment_mobile }}
                      "
                      style="
                        --pxu-section-block-heading-size: {{ block.settings.heading_size }}px;
                        --pxu-section-block-heading-size-mobile: {{ block.settings.heading_size_mobile }}px;
                        --pxu-section-block-text-size: {{ block.settings.text_size }}px;
                        --pxu-section-block-text-size-mobile: {{ block.settings.text_size_mobile }}px;
                        --pxu-section-block-text-color: {{ block.settings.text_color }};
                      "
                    >
                      <div class="pxu-slideshow__content" data-pxu-slideshow-content>
                        {%- if heading != blank -%}
                          <h2 class="pxu-slideshow__heading pxu-heading">
                            {{- heading -}}
                          </h2>
                        {%- endif -%}

                        {%- if text != blank -%}
                          <div class="pxu-slideshow__text pxu-rte">
                            {{- text -}}
                          </div>
                        {%- endif -%}

                        {%- if button_1_label != blank or button_2_label != blank -%}
                          <div class="pxu-slideshow__button-group pxu-btn-group">
                            {%- if button_1_label != blank -%}
                              <a
                                class="
                                  pxu-btn
                                  pxu-btn--{{ button_1_style }}
                                  pxu-btn--{{ button_1_brightness_mod }}
                                "
                                style="
                                  --pxu-btn-background-color: {{ button_1_background_color }};
                                  --pxu-btn-text-color: {{ button_1_text_color }};
                                "
                                href="{{ button_1_url }}"
                              >
                                {{- button_1_label -}}
                              </a>
                            {%- endif -%}

                            {%- if button_2_label != blank -%}
                              <a
                                class="
                                  pxu-btn
                                  pxu-btn--{{ button_2_style }}
                                  pxu-btn--{{ button_2_brightness_mod }}
                                "
                                style="
                                  --pxu-btn-background-color: {{ button_2_background_color }};
                                  --pxu-btn-text-color: {{ button_2_text_color }};
                                "
                                href="{{ button_2_url }}"
                              >
                                {{- button_2_label -}}
                              </a>
                            {%- endif -%}
                          </div>
                        {%- endif -%}
                      </div>
                    </div>
                  {%- endif -%}
                </div>
              </div>
            </div>
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</section>

<style type="text/css">
.pxu-section{--pxu-current-bp:"xxs"}@media only screen and (min-width:480px){.pxu-section{--pxu-current-bp:"xs"}}@media only screen and (min-width:720px){.pxu-section{--pxu-current-bp:"small"}}@media only screen and (min-width:860px){.pxu-section{--pxu-current-bp:"medium"}}@media only screen and (min-width:1024px){.pxu-section{--pxu-current-bp:"large"}}.pxu-slideshow{margin-bottom:calc(var(--pxu-section-margin-bottom, 0)*.75);margin-top:calc(var(--pxu-section-margin-top, 0)*.75)}@media only screen and (min-width:480px){.pxu-slideshow{margin-bottom:var(--pxu-section-margin-bottom,0);margin-top:var(--pxu-section-margin-top,0)}}.pxu-slideshow .pxu-carousel__item{width:100%}.pxu-slideshow__image-wrapper{display:flex;position:relative}.pxu-slideshow__image-wrapper:before{background-color:var(--pxu-section-image-overlay-color,transparent);content:"";height:100%;left:0;position:absolute;top:0;width:100%;z-index:1}.pxu-slideshow__image-wrapper--adapt{aspect-ratio:var(--pxu-section-mobile-aspect-ratio,auto)}@media only screen and (min-width:860px){.pxu-slideshow__image-wrapper--adapt{aspect-ratio:var(--pxu-section-desktop-aspect-ratio,auto)}}.pxu-slideshow__image-wrapper--small{height:300px}@media only screen and (min-width:860px){.pxu-slideshow__image-wrapper--small{height:500px}}.pxu-slideshow__image-wrapper--medium{height:450px}@media only screen and (min-width:860px){.pxu-slideshow__image-wrapper--medium{height:650px}}.pxu-slideshow__image-wrapper--large{height:600px}@media only screen and (min-width:860px){.pxu-slideshow__image-wrapper--large{height:800px}}.pxu-slideshow__image-wrapper--fit-content-height{aspect-ratio:auto;height:var(--pxu-carousel-content-height)}.pxu-slideshow__picture{display:block;height:100%;position:relative;width:100%}.pxu-slideshow__image{height:100%;left:0;-o-object-fit:cover;object-fit:cover;position:absolute;top:0;width:100%}.pxu-slideshow__content-wrapper{display:flex;flex-direction:column;height:100%;justify-content:center;left:50%;max-width:var(--pxu-width-max);padding:0 var(--pxu-space-4);position:absolute;top:0;transform:translateX(-50%);width:100%;z-index:2}.pxu-slideshow__content-wrapper--mobile-align-left{align-items:flex-start;text-align:left}.pxu-slideshow__content-wrapper--mobile-align-center{align-items:center;text-align:center}.pxu-slideshow__content-wrapper--mobile-align-right{align-items:flex-end;text-align:right}@media only screen and (min-width:860px){.pxu-slideshow__content-wrapper--align-left{align-items:flex-start;text-align:left}.pxu-slideshow__content-wrapper--align-center{align-items:center;text-align:center}.pxu-slideshow__content-wrapper--align-right{align-items:flex-end;text-align:right}.pxu-slideshow__content-wrapper{padding:var(--pxu-space-4) calc(var(--pxu-carousel-button-width) + var(--pxu-carousel-prev-next-position) + var(--pxu-space-14))}}.pxu-slideshow__content{max-width:var(--pxu-section-content-width)}.pxu-section--animated-true .pxu-slideshow__content{opacity:0}@media (prefers-reduced-motion:reduce){.pxu-section--animated-true .pxu-slideshow__content{opacity:1}}.pxu-section--animated-true .is-selected .pxu-slideshow__content{animation:pxu-fade-in-up var(--pxu-transition-duration-300) var(--pxu-transition-duration-300) var(--pxu-transition-ease-out) forwards}.pxu-slideshow__heading.pxu-heading{color:var(--pxu-section-block-text-color);font-size:var(--pxu-section-block-heading-size-mobile);margin-bottom:var(--pxu-space-3)}@media only screen and (min-width:860px){.pxu-slideshow__heading.pxu-heading{font-size:var(--pxu-section-block-heading-size)}}.pxu-slideshow__text{color:var(--pxu-section-block-text-color);font-size:var(--pxu-section-block-text-size-mobile);overflow-wrap:anywhere}@media only screen and (min-width:860px){.pxu-slideshow__text{font-size:var(--pxu-section-block-text-size)}}.pxu-slideshow__button-group{margin-top:var(--pxu-space-6)}</style>
{% javascript %}
const { Section, Carousel } = window.PxuThemeSections;

class SlideshowSection extends Section {
  constructor($root) {
    super($root);
    this.$root = $root;
    this.id = $root.id;
    this.data = this.loadData();
    this.autoplay = this.data.autoplay;
    this.autoplayDuration = this.data.autoplayDuration * 1000;
    this.carousel = null;

    this.onMount();
  }

  onMount() {
    const options = {
      autoPlay: this.autoplay ? this.autoplayDuration : false,
      prevNextButtons: true,
      lazyLoad: true
    };

    const mobileOptions = {
      draggable: true,
      autoPlay: this.autoplay ? this.autoplayDuration : false,
      lazyLoad: true
    };

    this.carousel = new Carousel(this.$root, options, mobileOptions);
    this.carousel.onMount();
  }

  onUnmount() {
    this.carousel.onUnmount();
    this.carousel = null;
  }

  onBlockSelect(event) {
    if (!this.carousel) return;
    const $slide = event.target.parentElement;
    this.carousel.selectSlide($slide);
  }
}

document.querySelectorAll('[data-pxu-slideshow]').forEach(($section) => {
  Section.init($section, SlideshowSection);
});

// export class for theme editor instance management
if (Shopify.designMode) {
  window.PxuThemeSections.SlideshowSection = SlideshowSection;
}
{% endjavascript %}
{% schema %}
{
  "name": "t:pxu_sections.sections.slideshow.name",
  "class": "pxu-slideshow-section",
  "settings": [
    {
      "type": "select",
      "id": "content_width",
      "label": "t:pxu_sections.common.content_width.label",
      "options": [
        {
          "value": "650px",
          "label": "t:pxu_sections.common.content_width.regular"
        },
        {
          "value": "800px",
          "label": "t:pxu_sections.common.content_width.wide"
        },
        {
          "value": "100%",
          "label": "t:pxu_sections.common.content_width.full_width"
        }
      ],
      "default": "650px"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "t:pxu_sections.sections.slideshow.autoplay.label",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_duration",
      "min": 3,
      "max": 12,
      "step": 1,
      "unit": "s",
      "label": "t:pxu_sections.sections.slideshow.autoplay_duration.label",
      "default": 5
    },
    {
      "type": "select",
      "id": "slide_height",
      "label": "t:pxu_sections.sections.slideshow.slide_height.label",
      "options": [
        {
          "value": "adapt",
          "label": "t:pxu_sections.common.image.adapt_to_first_image"
        },
        {
          "value": "small",
          "label": "t:pxu_sections.common.image.small"
        },
        {
          "value": "medium",
          "label": "t:pxu_sections.common.image.medium"
        },
        {
          "value": "large",
          "label": "t:pxu_sections.common.image.large"
        }
      ],
      "default": "small"
    },
    {
      "type": "header",
      "content": "t:pxu_sections.common.animations.animations"
    },
    {
      "type": "checkbox",
      "id": "enable_animations",
      "label": "t:pxu_sections.common.animations.enable_animations",
      "default": true
    },
    {
      "type": "header",
      "content": "t:pxu_sections.common.margin.header"
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:pxu_sections.common.margin.top",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:pxu_sections.common.margin.bottom",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "t:pxu_sections.sections.slideshow.blocks.slide.name",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:pxu_sections.common.image.image"
        },
        {
          "type": "inline_richtext",
          "id": "heading",
          "label": "t:pxu_sections.common.heading.name",
          "default": "Image slide"
        },
        {
          "type": "range",
          "id": "heading_size",
          "min": 16,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "t:pxu_sections.common.heading.heading_size",
          "default": 40
        },
        {
          "type": "range",
          "id": "heading_size_mobile",
          "min": 16,
          "max": 64,
          "step": 1,
          "unit": "px",
          "label": "t:pxu_sections.common.heading.heading_size_mobile",
          "default": 32
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "t:pxu_sections.common.text.name",
          "default": "t:pxu_sections.sections.slideshow.blocks.slide.text.default_html"
        },
        {
          "type": "range",
          "id": "text_size",
          "min": 12,
          "max": 32,
          "step": 1,
          "unit": "px",
          "label": "t:pxu_sections.common.text.text_size",
          "default": 16
        },
        {
          "type": "range",
          "id": "text_size_mobile",
          "min": 12,
          "max": 24,
          "step": 1,
          "unit": "px",
          "label": "t:pxu_sections.common.text.text_size_mobile",
          "default": 16
        },
        {
          "type": "select",
          "id": "content_alignment",
          "label": "t:pxu_sections.common.layout.content_alignment",
          "options": [
            {
              "value": "left",
              "label": "t:pxu_sections.common.layout.left"
            },
            {
              "value": "center",
              "label": "t:pxu_sections.common.layout.center"
            },
            {
              "value": "right",
              "label": "t:pxu_sections.common.layout.right"
            }
          ],
          "default": "left"
        },
        {
          "type": "header",
          "content": "t:pxu_sections.common.button.button_1"
        },
        {
          "type": "text",
          "id": "button_1_label",
          "label": "t:pxu_sections.common.button.label",
          "default": "t:pxu_sections.common.button.button"
        },
        {
          "type": "url",
          "id": "button_1_url",
          "label": "t:pxu_sections.common.button.link"
        },
        {
          "type": "select",
          "id": "button_1_style",
          "label": "t:pxu_sections.common.button.style",
          "options": [
            {
              "value": "fill",
              "label": "t:pxu_sections.common.button.fill"
            },
            {
              "value": "outline",
              "label": "t:pxu_sections.common.button.outline"
            }
          ],
          "default": "fill"
        },
        {
          "type": "color",
          "id": "button_1_background_color",
          "label": "t:pxu_sections.common.color.background_color",
          "default": "#000000",
          "info": "t:pxu_sections.common.button.background_color_info"
        },
        {
          "type": "color",
          "id": "button_1_text_color",
          "label": "t:pxu_sections.common.color.text_color",
          "default": "#FFFFFF"
        },
        {
          "type": "header",
          "content": "t:pxu_sections.common.button.button_2"
        },
        {
          "type": "text",
          "id": "button_2_label",
          "label": "t:pxu_sections.common.button.label",
          "default": "t:pxu_sections.common.button.button"
        },
        {
          "type": "url",
          "id": "button_2_url",
          "label": "t:pxu_sections.common.button.link"
        },
        {
          "type": "select",
          "id": "button_2_style",
          "label": "t:pxu_sections.common.button.style",
          "options": [
            {
              "value": "fill",
              "label": "t:pxu_sections.common.button.fill"
            },
            {
              "value": "outline",
              "label": "t:pxu_sections.common.button.outline"
            }
          ],
          "default": "fill"
        },
        {
          "type": "color",
          "id": "button_2_background_color",
          "label": "t:pxu_sections.common.color.background_color",
          "default": "#000000",
          "info": "t:pxu_sections.common.button.background_color_info"
        },
        {
          "type": "color",
          "id": "button_2_text_color",
          "label": "t:pxu_sections.common.color.text_color",
          "default": "#FFFFFF"
        },
        {
          "type": "header",
          "content": "t:pxu_sections.common.layout.mobile"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "t:pxu_sections.common.image.mobile_image"
        },
        {
          "type": "select",
          "id": "content_alignment_mobile",
          "label": "t:pxu_sections.common.layout.mobile_content_alignment",
          "options": [
            {
              "value": "left",
              "label": "t:pxu_sections.common.layout.left"
            },
            {
              "value": "center",
              "label": "t:pxu_sections.common.layout.center"
            },
            {
              "value": "right",
              "label": "t:pxu_sections.common.layout.right"
            }
          ],
          "default": "center"
        },
        {
          "type": "header",
          "content": "t:pxu_sections.common.color.color"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "t:pxu_sections.common.color.text_color",
          "default": "#FFFFFF"
        },
        {
          "type": "color",
          "id": "image_overlay_color",
          "label": "t:pxu_sections.common.color.image_overlay_color",
          "default": "#000000"
        },
        {
          "type": "range",
          "id": "image_overlay_opacity",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "t:pxu_sections.common.image.image_overlay_opacity",
          "default": 20
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": [
      "header",
      "footer"
    ]
  },
  "presets": [
    {
      "name": "t:pxu_sections.sections.slideshow.name",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}